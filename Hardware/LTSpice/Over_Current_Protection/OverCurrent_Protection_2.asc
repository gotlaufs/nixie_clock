Version 4
SHEET 1 2320 1300
WIRE 1248 16 1216 16
WIRE 1376 16 1328 16
WIRE -416 112 -448 112
WIRE -256 112 -416 112
WIRE -144 112 -256 112
WIRE 80 112 -48 112
WIRE 1040 112 80 112
WIRE 1120 112 1040 112
WIRE 1216 112 1216 16
WIRE 1216 112 1120 112
WIRE 1248 112 1216 112
WIRE 1376 112 1376 16
WIRE 1376 112 1328 112
WIRE 1440 112 1376 112
WIRE 1568 112 1440 112
WIRE -256 144 -256 112
WIRE 80 160 80 112
WIRE 1040 224 1040 112
WIRE -256 240 -256 224
WIRE -128 240 -128 160
WIRE -128 240 -256 240
WIRE -128 272 -128 240
WIRE 1568 288 1568 112
WIRE 1888 288 1888 112
WIRE 16 320 -64 320
WIRE 80 320 80 240
WIRE 80 320 16 320
WIRE 144 320 80 320
WIRE 240 320 224 320
WIRE 336 320 304 320
WIRE 592 320 336 320
WIRE 608 320 592 320
WIRE -448 336 -448 112
WIRE 80 384 80 320
WIRE 608 416 608 320
WIRE 336 512 336 320
WIRE -448 624 -448 416
WIRE -128 624 -128 368
WIRE 80 624 80 464
WIRE 608 624 608 496
WIRE 1040 624 1040 288
WIRE 1568 624 1568 368
WIRE 1888 624 1888 368
WIRE 1168 736 880 736
WIRE 1168 768 1168 736
WIRE 1504 816 1488 816
WIRE 1664 816 1584 816
WIRE 16 848 16 320
WIRE 800 864 800 768
WIRE 1664 864 1664 816
WIRE 1696 864 1664 864
WIRE 1856 864 1776 864
WIRE 880 880 880 736
WIRE 880 880 816 880
WIRE 1600 880 1600 768
WIRE 192 896 80 896
WIRE 432 896 192 896
WIRE 560 896 512 896
WIRE 640 896 560 896
WIRE 656 896 640 896
WIRE 752 896 656 896
WIRE 1664 896 1664 864
WIRE 1664 896 1616 896
WIRE 864 912 816 912
WIRE 928 912 864 912
WIRE 1056 912 1008 912
WIRE 1488 912 1488 816
WIRE 1488 912 1056 912
WIRE 1552 912 1488 912
WIRE 1664 928 1616 928
WIRE 192 944 192 896
WIRE 1664 944 1664 928
WIRE 1680 944 1664 944
WIRE 1696 944 1680 944
WIRE 1856 944 1776 944
WIRE 560 976 560 896
WIRE 640 976 640 896
WIRE 688 976 640 976
WIRE 864 976 864 912
WIRE 864 976 768 976
WIRE 1680 976 1680 944
WIRE 336 992 336 592
WIRE 336 992 256 992
WIRE 16 1280 16 944
WIRE 192 1280 192 1040
WIRE 560 1280 560 1056
WIRE 800 1280 800 928
WIRE 1168 1280 1168 848
WIRE 1600 1280 1600 944
WIRE 1680 1280 1680 1056
FLAG 80 624 0
FLAG -128 624 0
FLAG -448 624 0
FLAG -416 112 Vin
FLAG 1440 112 Vout
FLAG 608 624 0
FLAG 592 320 Von
FLAG 1568 624 0
FLAG 1888 624 0
FLAG 1888 112 R_voltage
FLAG 1120 112 V_source
FLAG 16 1280 0
FLAG 1040 624 0
FLAG 1600 1280 0
FLAG 1600 768 Vin
FLAG 1680 1280 0
FLAG 1056 912 V_diff
FLAG 1168 1280 0
FLAG 800 1280 0
FLAG 800 768 Vin
FLAG 656 896 V_cmp
FLAG 1856 944 V_source
FLAG 1856 864 Vout
FLAG 560 1280 0
FLAG 192 1280 0
SYMBOL pmos -48 160 M270
SYMATTR InstName M1
SYMATTR Value IRF7207
SYMBOL res 1344 96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 0.51
SYMBOL res 1344 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 0.51
SYMBOL res 64 368 R0
SYMATTR InstName R4
SYMATTR Value 2.2k
SYMBOL res 240 304 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 1k
SYMBOL diode 304 304 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL npn -64 272 M0
SYMATTR InstName Q1
SYMATTR Value 2N3904
SYMBOL voltage -448 320 R0
SYMATTR InstName V1
SYMATTR Value 12
SYMBOL voltage 608 400 R0
WINDOW 3 -145 99 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value PULSE(0 3.3 5m 1n 1n 5m 25m)
SYMATTR InstName V2
SYMBOL res 1552 272 R0
SYMATTR InstName Rload
SYMATTR Value R=V(R_voltage)*100
SYMBOL res -272 128 R0
SYMATTR InstName R3
SYMATTR Value 15k
SYMBOL res 64 144 R0
SYMATTR InstName R6
SYMATTR Value 10k
SYMBOL voltage 1888 272 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V3
SYMATTR Value PWL(0 1 10m 1 50m 0.1 100m 1)
SYMBOL npn 80 848 M0
SYMATTR InstName Q2
SYMATTR Value 2N3904
SYMBOL cap 1024 224 R0
SYMATTR InstName C1
SYMATTR Value 0.22µ IC=0
SYMBOL res 1600 800 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 20k
SYMBOL res 1680 880 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R8
SYMATTR Value 1k
SYMBOL res 1792 928 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 1k
SYMBOL res 1664 960 R0
SYMATTR InstName R10
SYMATTR Value 20k
SYMBOL res 1024 896 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 1k
SYMBOL res 784 960 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 12k
SYMBOL voltage 1168 752 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4
SYMATTR Value 2.77
SYMBOL Opamps\\LT1218 1584 912 M0
SYMATTR InstName U1
SYMBOL Opamps\\LT1218 784 896 M0
SYMATTR InstName U2
SYMBOL res 544 960 R0
SYMATTR InstName R13
SYMATTR Value 10meg
SYMBOL res 528 880 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 47k
SYMBOL npn 256 944 M0
SYMATTR InstName Q3
SYMATTR Value 2N3904
SYMBOL res 320 496 R0
SYMATTR InstName R15
SYMATTR Value 10k
TEXT -448 792 Left 2 !.tran 0 100m 0 1m
TEXT 784 224 Left 2 ;Initial source voltage\n(output) = 0 V
TEXT 1928 184 Left 2 ;This models a varying\nresistance with time
TEXT 1160 -112 Left 2 ;This is the overcurrent\nprotection resistor already\npresent in the HV PSU\ncircuit.
TEXT 1176 184 Left 2 ;At 7W input power,\nVoltage drop is ~150 mV
TEXT 1632 752 Left 2 ;Diff amplifier with G = 20\n150mV => 3 V
TEXT 1776 1000 Left 2 ;Rail-to-Rail input op amp\nmust be used, because both\nvoltages are close to op amp's\nsupply voltage.\nAlso it must be a single-supply\ntype.
TEXT 632 336 Left 2 ;Supply can be turned on by\ngiving a positive pulse here
TEXT 584 768 Left 2 ;Non-inverting\ncomparator with\nhysteresis of 2V
TEXT 872 656 Left 2 ;Reference voltage for the comparator.\nIf this is higher, comparator will trip at higher\ncurrent level (output from diff amp).
TEXT 1256 752 Left 2 ;2.77 V corresponds to\ntripping at 3 V
TEXT -408 856 Left 2 ;When the comparator trips, it will:\nTurn on Q2\nThat will turn off Q1\nAnd that will turn of the M1
TEXT -440 1048 Left 2 ;Q3 is the override for Q2.\nIf it is present then a positive pulse on\nVon will turn on the output regardless\nof current.\nOtherwise output will oscillate!
TEXT 816 1040 Left 2 ;Use "ClaculateResistors.py"\nto calculate the resistor\nvalues
